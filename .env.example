# ================================================================
# Environment Configuration
# ================================================================
# Runtime mode: 'production' or 'development'
# Production enforces security key requirements
ENVIRONMENT=production

# ================================================================
# Database Configuration
# ================================================================
# PostgreSQL credentials (used by both API and database containers)
# CRITICAL: Set POSTGRES_PASSWORD before first 'docker compose up'
# Changing password after database creation requires volume deletion

POSTGRES_USER=backend_user
POSTGRES_PASSWORD=<GENERATE_SECURE_PASSWORD>
POSTGRES_DB=backend_db

# Database connection string (automatically constructed, don't edit)
# postgresql://backend_user:<POSTGRES_PASSWORD>@db:5432/backend_db

# ================================================================
# Security Keys (REQUIRED in production)
# ================================================================
# Generate each key with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
# Each key must be unique - run the command 4 times
# NEVER commit these keys to git or reuse them across environments

# Protects admin endpoints like /refresh-data (use in X-API-Key header)
INTERNAL_API_KEY=<GENERATE_KEY>

# Signs OAuth state tokens for CSRF protection (128-bit HMAC)
STATE_SECRET=<GENERATE_KEY>

# Encrypts OAuth tokens at rest (Fernet AES-128-CBC)
# WARNING: Never rotate without migrating existing tokens
ENCRYPTION_KEY=<GENERATE_KEY>

# ================================================================
# Strava OAuth Configuration
# ================================================================
# Get credentials from: https://www.strava.com/settings/api
# 1. Create a new application
# 2. Set Authorization Callback Domain to: api.yourdomain.com (or localhost for dev)
# 3. Copy Client ID and Client Secret below

STRAVA_CLIENT_ID=<your_client_id_from_strava>
STRAVA_CLIENT_SECRET=<your_client_secret_from_strava>

# OAuth callback URL (must match Strava app settings exactly)
# Production: https://api.yourdomain.com/strava/callback (MUST use HTTPS)
# Local dev:  http://localhost:5001/strava/callback
STRAVA_REDIRECT_URI=https://api.yourdomain.com/strava/callback

# ================================================================
# Frontend Integration (Optional)
# ================================================================
# Your frontend URL for CORS and OAuth redirects
# Production: https://yourdomain.com
# Local dev:  http://localhost:5173
FRONTEND_URL=https://yourdomain.com

# ================================================================
# Example Configurations
# ================================================================

# --- PRODUCTION EXAMPLE ---
# ENVIRONMENT=production
# POSTGRES_PASSWORD=vF8kL2mN9pQ3rT6sU1xY4zA7bC0dE5gH
# INTERNAL_API_KEY=aB2cD4eF6gH8iJ0kL1mN3oP5qR7sT9uV
# STATE_SECRET=wX0yZ2aB4cD6eF8gH9iJ1kL3mN5oP7qR
# ENCRYPTION_KEY=sT8uV0wX2yZ4aB6cD8eF0gH2iJ4kL6mN
# STRAVA_CLIENT_ID=161983
# STRAVA_CLIENT_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
# STRAVA_REDIRECT_URI=https://api.yourdomain.com/strava/callback
# FRONTEND_URL=https://yourdomain.com

# --- LOCAL DEVELOPMENT EXAMPLE ---
# ENVIRONMENT=development
# POSTGRES_PASSWORD=devpass123
# INTERNAL_API_KEY=dev-api-key
# STATE_SECRET=dev-state-secret
# ENCRYPTION_KEY=dev-encryption-key
# STRAVA_CLIENT_ID=161983
# STRAVA_CLIENT_SECRET=your_dev_client_secret
# STRAVA_REDIRECT_URI=http://localhost:5001/strava/callback
# FRONTEND_URL=http://localhost:5173
